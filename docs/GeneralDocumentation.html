<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MASFENON: General framework documentation</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MASFENON
   </div>
   <div id="projectbrief">Multi-Agent Adaptive Simulation Framework for Evolution in Networks of Networks</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">General framework documentation</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md2"></a>
Framework Documentation</h1>
<p>This part of the documentation serves as a practical guide for users who wish to explore the technical details of the <b>MASFENON</b> framework and learn how to operate it effectively. Here we provide an overview of MASFENON usage, including:</p>
<ul>
<li>Running MASFENON with the provided scripts.</li>
<li>Understanding and configuring simulation parameters.</li>
<li>Addressing common deployment issues, such as running MPI in local builds.</li>
<li>Notes on parallel execution and hardware considerations.</li>
</ul>
<p>The purpose of this section is not only to document operational procedures, but also to support reproducibility of the experiments described in the thesis and to help future users adapt MASFENON to their own research use cases.</p>
<p>For readers seeking more in-depth technical documentation of the internal implementation (class structures, methods, source code references, etc.), the complete and always up-to-date <b>Doxygen-generated documentation</b> is publicly available at:</p>
<p>ðŸ‘‰ <a href="https://josura.github.io/MASFENON/">https://josura.github.io/MASFENON/</a></p>
<p>This online resource provides detailed developer-oriented documentation, including C++ class hierarchies, function descriptions, code examples, and internal module dependencies. It is recommended for advanced users and developers intending to extend the framework or integrate it into custom workflows.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md4"></a>
B.1 Introduction</h2>
<p><b>MASFENON</b> (Multiagent Adaptive Simulation Framework for Evolution in Networks of Networks) is a standalone simulation framework designed to handle complex dynamic systems through modular multi-agent interaction. It was originally developed as part of the <b>c2c-sepia</b> project and has now been extracted as a clean, optimized version.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
B.1.1 Dependencies</h3>
<ul>
<li><a href="https://arma.sourceforge.net/">Armadillo</a></li>
<li>MPI implementation (tested on <a href="https://www.open-mpi.org">OpenMPI</a>)</li>
<li><a href="https://www.boost.org/">Boost</a> â€” ensure <code>program_options</code> is installed if needed</li>
</ul>
<h3><a class="anchor" id="autotoc_md6"></a>
B.1.2 File Structure</h3>
<div class="fragment"><div class="line">.</div>
<div class="line">\|-- CMakeLists.txt           # CMake build configuration</div>
<div class="line">\|-- examples.md              # Usage and plotting examples</div>
<div class="line">\|-- .github/                 # CI workflows</div>
<div class="line">\|-- build/                   # Build output</div>
<div class="line">\|-- src/                     # Source code</div>
<div class="line">\|-- data/                    # Sample/test datasets</div>
<div class="line">\-- scripts/                  # Bash and Python helper scripts</div>
<div class="line"> </div>
<div class="line">````</div>
<div class="line"> </div>
<div class="line">### B.1.3 Build</div>
</div><!-- fragment --><p> bash cmake -B build cd build make </p><div class="fragment"><div class="line">### B.1.4 Usage</div>
<div class="line"> </div>
<div class="line">**Help Message:**</div>
<div class="line"> </div>
<div class="line">```bash</div>
<div class="line">./build/masfenon-MPI --help</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">**Example Run:**</div>
<div class="line"> </div>
<div class="line">```bash</div>
<div class="line">./build/masfenon-MPI \</div>
<div class="line">  --fUniqueGraph graph.tsv \</div>
<div class="line">  --fInitialPerturbationPerType matrix.tsv \</div>
<div class="line">  --typeInteractionFolder typesInteractionFolder/</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">### B.1.5 Parameter Customization</div>
<div class="line"> </div>
<div class="line">Custom scaling functions (dissipation, conservation, etc.) can be modified in `src/CustomFunctions`.</div>
<div class="line"> </div>
<div class="line">### B.1.6 Propagation Function Customization</div>
<div class="line"> </div>
<div class="line">Propagation functions can be customized in `src/computation/PropagationModelCustom`.</div>
<div class="line"> </div>
<div class="line">### B.1.7 License</div>
<div class="line"> </div>
<div class="line">This project is released under the [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/).</div>
<div class="line"> </div>
<div class="line">For issues, please use the GitHub issues page: [https://github.com/josura/MASFENON/issues](https://github.com/josura/MASFENON/issues)</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">## B.2 Inputs and Parameters of the Framework</div>
<div class="line"> </div>
<div class="line">This section documents the command-line interface (CLI) inputs, expected file formats, and configuration parameters of the **MASFENON** framework. Options are provided via Boost.Program\_options. Boolean switches are disabled by default unless explicitly set.</div>
<div class="line"> </div>
<div class="line">### B.2.1 Data Inputs and File Formats</div>
<div class="line"> </div>
<div class="line">At minimum, the framework requires:</div>
<div class="line"> </div>
<div class="line">* A graph (unique file or a folder of graphs), and</div>
<div class="line">* An initial perturbation matrix (unique file or a folder of matrices).</div>
<div class="line"> </div>
<div class="line">Exactly one of the following must be specified for graphs:</div>
<div class="line"> </div>
<div class="line">* `--fUniqueGraph &lt;file&gt;` **OR** `--graphsFilesFolder &lt;folder&gt;`</div>
<div class="line"> </div>
<div class="line">Exactly one of the following should be specified for perturbations:</div>
<div class="line"> </div>
<div class="line">* `--fInitialPerturbationPerType &lt;file&gt;` **OR** `--initialPerturbationPerTypeFolder &lt;folder&gt;`</div>
<div class="line"> </div>
<div class="line">Optionally, inter-type interactions, node descriptions, and a list of subtypes can be provided.</div>
<div class="line"> </div>
<div class="line">#### File Schemas</div>
<div class="line"> </div>
<div class="line">**Graph (edge list):** `graph.tsv`</div>
<div class="line"> </div>
<div class="line">```</div>
<div class="line">start    end    weight</div>
<div class="line">geneA    geneB  0.123</div>
<div class="line">...</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">**Initial perturbation (homogeneous):** `initialPerturbationHomogeneous.tsv`</div>
<div class="line"> </div>
<div class="line">```</div>
<div class="line">name    type1          type2        ...    typeN</div>
<div class="line">gene1   lfc_type1:g1   lfc_type2:g1 ...    lfc_typeN:g1</div>
<div class="line">gene2   lfc_type1:g2   lfc_type2:g2 ...    lfc_typeN:g2</div>
<div class="line">...</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">**Initial perturbation (heterogeneous):** `initialPerturbation-typeN.tsv`</div>
<div class="line"> </div>
<div class="line">```</div>
<div class="line">name    value</div>
<div class="line">gene1   lfc_typeN:g1</div>
<div class="line">gene2   lfc_typeN:g2</div>
<div class="line">...</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">**Inter-type interactions:** `typesInteraction.tsv`</div>
<div class="line"> </div>
<div class="line">```</div>
<div class="line">startType  startNodeName  endType  endNodeName  weight</div>
<div class="line">type0      gene-e         type1    gene-a       1.0</div>
<div class="line">...</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">**Subtypes list (optional):** `subtypes.txt`</div>
<div class="line"> </div>
<div class="line">```</div>
<div class="line">type1</div>
<div class="line">type3</div>
<div class="line">...</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">**Node descriptions (optional)**:</div>
<div class="line"> </div>
<div class="line">* Single file: `--nodeDescriptionFile &lt;file&gt;`</div>
<div class="line">* Per-graph folder: `--nodeDescriptionFolder &lt;folder&gt;`</div>
<div class="line"> </div>
<div class="line">Each file should list node identifiers (and optionally annotations). If not provided, nodes are inferred from edges.</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.2 Input Locations</div>
<div class="line"> </div>
<div class="line">* `--fUniqueGraph &lt;string&gt;`</div>
<div class="line">* `--graphsFilesFolder &lt;string&gt;`</div>
<div class="line">* `--fInitialPerturbationPerType &lt;string&gt;`</div>
<div class="line">* `--initialPerturbationPerTypeFolder &lt;string&gt;`</div>
<div class="line">* `--typeInteractionFolder &lt;string&gt;`</div>
<div class="line">* `--nodeDescriptionFile &lt;string&gt;`</div>
<div class="line">* `--nodeDescriptionFolder &lt;string&gt;`</div>
<div class="line">* `--subtypes &lt;string&gt;`</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.3 Dynamics and Time Discretization</div>
<div class="line"> </div>
<div class="line">* `--intratypeIterations &lt;int&gt;`</div>
<div class="line">* `--intertypeIterations &lt;int&gt;`</div>
<div class="line">* `--timestep &lt;double&gt;` â†’ Î”t</div>
<div class="line">  Total simulated time: `T = I_inter Ã— Î”t`</div>
<div class="line">* `--quantizationMethod &lt;string&gt;` (`single` or `multiple`)</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.4 Physical/Computational Models and Parameters</div>
<div class="line"> </div>
<div class="line">**Dissipation**</div>
<div class="line"> </div>
<div class="line">* `--dissipationModel &lt;string&gt;`: `none | power | random | periodic | scaled | custom`</div>
<div class="line">* `--dissipationModelParameters &lt;vector&lt;double&gt;&gt;`</div>
<div class="line"> </div>
<div class="line">**Conservation**</div>
<div class="line"> </div>
<div class="line">* `--conservationModel &lt;string&gt;`: `none | scaled | random | custom`</div>
<div class="line">* `--conservationModelParameters &lt;vector&lt;double&gt;&gt;`</div>
<div class="line"> </div>
<div class="line">**Propagation**</div>
<div class="line"> </div>
<div class="line">* `--propagationModel &lt;string&gt;`: `default | scaled | neighbors | customScaling | customScalingNeighbors | customPropagation`</div>
<div class="line">* `--propagationModelParameters &lt;vector&lt;double&gt;&gt;`</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.5 Saturation and Norm Constraints</div>
<div class="line"> </div>
<div class="line">* `--saturation`</div>
<div class="line">* `--saturationTerm &lt;double&gt;` â†’ bounds \[-s, s]</div>
<div class="line">* `--customSaturationFunction`</div>
<div class="line">* `--conservateInitialNorm`</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.6 Topology and Virtual Nodes</div>
<div class="line"> </div>
<div class="line">* `--undirectedEdges`</div>
<div class="line">* `--undirectedTypeEdges`</div>
<div class="line">* `--sameTypeCommunication`</div>
<div class="line">* `--virtualNodesGranularity &lt;string&gt;` (`type`, `node`, `typeAndNode`)</div>
<div class="line">* `--virtualNodesGranularityParameters &lt;vector&lt;string&gt;&gt;`</div>
<div class="line">* `--resetVirtualOutputs`</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.7 Logging, Robustness, and Runtime Controls</div>
<div class="line"> </div>
<div class="line">* `--loggingOptions &lt;string&gt;`: `all` (default) or `none`</div>
<div class="line">* `--verbose`</div>
<div class="line">* `--treatWarningAsError`</div>
<div class="line">* `--resumeCheckpoint`</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.8 Outputs and Performance Tracking</div>
<div class="line"> </div>
<div class="line">* `--outputFolder &lt;string&gt;`</div>
<div class="line">* `--outputFormat &lt;string&gt;` (`singleIteration` or `iterationMatrix`)</div>
<div class="line">* `--saveAugmentedNetworks`</div>
<div class="line">* `--savePerformance &lt;string&gt;`</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.9 Example CLI Invocation</div>
<div class="line"> </div>
<div class="line">```bash</div>
<div class="line">./masfenon-MPI \</div>
<div class="line">  --fUniqueGraph data/testdata/testGraph/edges-Graph1-general.tsv \</div>
<div class="line">  --fInitialPerturbationPerType data/testdata/testGraph/initialValues-general.tsv \</div>
<div class="line">  --typeInteractionFolder data/testdata/testHeterogeneousGraph/interactions \</div>
<div class="line">  --intratypeIterations 20 \</div>
<div class="line">  --intertypeIterations 10 \</div>
<div class="line">  --timestep 0.1 \</div>
<div class="line">  --propagationModel scaled \</div>
<div class="line">  --propagationModelParameters 0.8 \</div>
<div class="line">  --dissipationModel power \</div>
<div class="line">  --dissipationModelParameters 0.95 \</div>
<div class="line">  --conservationModel scaled \</div>
<div class="line">  --conservationModelParameters 0.9 \</div>
<div class="line">  --saturation --saturationTerm 1.0 \</div>
<div class="line">  --undirectedEdges --undirectedTypeEdges \</div>
<div class="line">  --outputFolder out/run1 \</div>
<div class="line">  --outputFormat iterationMatrix \</div>
<div class="line">  --savePerformance out/run1/perf.tsv \</div>
<div class="line">  --loggingOptions all --verbose</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.10 Tabular Summary of Options</div>
<div class="line"> </div>
<div class="line">| Option                              | Type           | Default         | Notes                                            |</div>
<div class="line">| ----------------------------------- | -------------- | --------------- | ------------------------------------------------ |</div>
<div class="line">| `fUniqueGraph`                      | string         | â€”               | Single graph file; XOR with `graphsFilesFolder`. |</div>
<div class="line">| `graphsFilesFolder`                 | string         | â€”               | Folder of graphs.                                |</div>
<div class="line">| `fInitialPerturbationPerType`       | string         | â€”               | Single perturbation file.                        |</div>
<div class="line">| `initialPerturbationPerTypeFolder`  | string         | â€”               | Folder of perturbation files.                    |</div>
<div class="line">| `typeInteractionFolder`             | string         | â€”               | Inter-type edges folder.                         |</div>
<div class="line">| `nodeDescriptionFile`               | string         | â€”               | Node names (common graph).                       |</div>
<div class="line">| `nodeDescriptionFolder`             | string         | â€”               | Node names (per-graph).                          |</div>
<div class="line">| `subtypes`                          | string         | â€”               | Optional subtype list.                           |</div>
<div class="line">| `intratypeIterations`               | int            | â€”               | &gt;0                                               |</div>
<div class="line">| `intertypeIterations`               | int            | â€”               | &gt;0                                               |</div>
<div class="line">| `timestep`                          | double         | â€”               | Î”t                                               |</div>
<div class="line">| `quantizationMethod`                | string         | â€”               | single \| multiple                               |</div>
<div class="line">| `dissipationModel`                  | string         | none            | See list above.                                  |</div>
<div class="line">| `dissipationModelParameters`        | vector&lt;double&gt; | â€”               | Model-dependent.                                 |</div>
<div class="line">| `conservationModel`                 | string         | none            | See list above.                                  |</div>
<div class="line">| `conservationModelParameters`       | vector&lt;double&gt; | â€”               | Model-dependent.                                 |</div>
<div class="line">| `propagationModel`                  | string         | default         | See list above.                                  |</div>
<div class="line">| `propagationModelParameters`        | vector&lt;double&gt; | â€”               | Model-dependent.                                 |</div>
<div class="line">| `saturation`                        | flag           | off             | Enable clipping.                                 |</div>
<div class="line">| `saturationTerm`                    | double         | 1.0             | Requires `--saturation`.                         |</div>
<div class="line">| `customSaturationFunction`          | flag           | off             | User-defined.                                    |</div>
<div class="line">| `conservateInitialNorm`             | flag           | off             | Norm constraint.                                 |</div>
<div class="line">| `undirectedEdges`                   | flag           | off             | Intra-graph undirected.                          |</div>
<div class="line">| `undirectedTypeEdges`               | flag           | off             | Inter-type undirected.                           |</div>
<div class="line">| `sameTypeCommunication`             | flag           | off             | Same-type virtual node.                          |</div>
<div class="line">| `resetVirtualOutputs`               | flag           | off             | Zeroed each iteration.                           |</div>
<div class="line">| `virtualNodesGranularity`           | string         | type            | type \| node \| typeAndNode                      |</div>
<div class="line">| `virtualNodesGranularityParameters` | vector&lt;string&gt; | â€”               | Reserved.                                        |</div>
<div class="line">| `loggingOptions`                    | string         | all             | all \| none                                      |</div>
<div class="line">| `verbose`                           | flag           | off             | Extra logs.                                      |</div>
<div class="line">| `treatWarningAsError`               | flag           | off             | Fail on warning.                                 |</div>
<div class="line">| `resumeCheckpoint`                  | flag           | off             | Resume run.                                      |</div>
<div class="line">| `outputFolder`                      | string         | â€”               | Required for outputs.                            |</div>
<div class="line">| `outputFormat`                      | string         | singleIteration | Iteration output mode.                           |</div>
<div class="line">| `saveAugmentedNetworks`             | flag           | off             | Save augmented graphs.                           |</div>
<div class="line">| `savePerformance`                   | string         | off             | Save runtime summary.                            |</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">### B.2.11 Additional considerations</div>
<div class="line"> </div>
<div class="line">If there are problems with the options, file, or consistency, the program will throw exceptions with explanatory error messages, or print warnings. Use `--verbose` for more details.</div>
<div class="line"> </div>
<div class="line">## B.3 Fitting Procedure and Scripts</div>
<div class="line"> </div>
<div class="line">In addition to the general-purpose simulation parameters, **MASFENON** includes a dedicated fitting workflow for calibrating the simulation to experimental single-cell data. In the current implementation, this process has been applied to fit the model to the *AT1* cell metabolite layer in scRNA-seq data.</div>
<div class="line"> </div>
<div class="line">### B.3.1 Overview</div>
<div class="line"> </div>
<div class="line">The fitting pipeline iteratively adjusts the **dissipation**, **propagation**, and **conservation** model parameters to minimize the mean squared error (MSE) between simulated outputs and experimental data at specific timepoints. The process is controlled by a main Bash script, which:</div>
<div class="line"> </div>
<div class="line">1. Sets the fitting mode (manual parameter ranges or resume from previous results).</div>
<div class="line">2. Runs multiple **epochs**, each consisting of:</div>
<div class="line">   - Executing the MASFENON simulation with the current parameter ranges.</div>
<div class="line">   - Computing MSE values for each experiment/timepoint.</div>
<div class="line">   - Generating updated parameter ranges for the next epoch, based on MSE ranking.</div>
<div class="line">3. Saves all intermediate results, MSE tables, and updated parameter ranges in a user-defined output folder.</div>
<div class="line"> </div>
<div class="line">### B.3.2 Required Scripts</div>
<div class="line"> </div>
<div class="line">The fitting workflow depends on the following scripts:</div>
<div class="line"> </div>
<div class="line">- **`simulation_custom_parameters.sh`**  </div>
<div class="line">  Runs a MASFENON simulation with explicit dissipation, propagation, and conservation parameter ranges.  </div>
<div class="line">  Parameters:  </div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">minDiss maxDiss dissSteps minProp maxProp propSteps minCons maxCons consSteps</div>
<div class="line"> </div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">- **`compute-MSE-metabolites.py`**  </div>
<div class="line">Computes the MSE between simulation outputs and experimental data for each available timepoint (e.g., 6h, 7h, 10h).  </div>
<div class="line">Outputs an MSE-sorted table in the format:</div>
<div class="line">```</div>
<div class="line"> </div>
<div class="line">MSE    experiment</div>
<div class="line">0.012  dissipation\_&lt;d&gt;-propagation\_&lt;p&gt;-conservation\_&lt;c&gt;</div>
<div class="line">...</div>
</div><!-- fragment --><p> This script is part of the <a href="https://github.com/josura/c2c-sepia">c2c-sepia repository</a>.</p>
<ul>
<li>**<code>createNewParametersFromMSEtable.sh</code>** <br  />
 Reads an MSE table and generates new parameter ranges around the best-performing configurations, for use in the next fitting epoch.</li>
</ul>
<h3><a class="anchor" id="autotoc_md7"></a>
B.3.3 Execution Modes</h3>
<p>The main fitting script supports two execution modes:</p>
<p><b>Manual Range Mode</b> </p><div class="fragment"><div class="line">./fit-and-run-simulation.sh &lt;epochs&gt; &lt;OutputFolder&gt; &lt;minParam&gt; &lt;maxParam&gt; &lt;intervals&gt;</div>
<div class="line">````</div>
<div class="line"> </div>
<div class="line">All three parameter families (dissipation, propagation, conservation) share the same starting min, max, and number of intervals.</div>
<div class="line"> </div>
<div class="line">**Resume Mode**</div>
</div><!-- fragment --><p> bash ./fit-and-run-simulation.sh &lt;epochs&gt; &lt;OutputFolder&gt; </p><div class="fragment"><div class="line">Reads previous simulation results from `&lt;OutputFolder&gt;`, computes the MSE tables, and generates new ranges from them. Useful to continue fitting without restarting from scratch.</div>
<div class="line"> </div>
<div class="line">### B.3.4 Epoch Loop and Parameter Update</div>
<div class="line"> </div>
<div class="line">Each epoch proceeds as follows:</div>
<div class="line"> </div>
<div class="line">1. Create an `epoch_&lt;n&gt;` subfolder inside `&lt;OutputFolder&gt;`.</div>
<div class="line">2. Run the simulation with current parameter ranges:</div>
</div><!-- fragment --><p> bash bash simulation_custom_parameters.sh \ minDiss maxDiss dissSteps \ minProp maxProp propSteps \ minCons maxCons consSteps </p><div class="fragment"><div class="line">3. Compute MSE values for each timepoint:</div>
</div><!-- fragment --><p> bash python3 compute-MSE-metabolites.py epoch_&lt;n&gt; </p><div class="fragment"><div class="line">4. From the MSE table of the selected fitting timepoint (e.g., 10h), extract top configurations and generate updated parameter ranges:</div>
</div><!-- fragment --><p> bash bash createNewParametersFromMSEtable.sh \ epoch_&lt;n&gt;/mse_10h.tsv \ 5 \ &lt;intervals&gt; \ epoch_&lt;n&gt;/newParams_mse_10h.txt </p><div class="fragment"><div class="line">5. Update `min`, `max`, and `intervals` for each parameter family from the generated file.</div>
<div class="line"> </div>
<div class="line">### B.3.5 Environment Requirements</div>
<div class="line"> </div>
<div class="line">The fitting process requires:</div>
<div class="line"> </div>
<div class="line">* A Python virtual environment with dependencies for `compute-MSE-metabolites.py`. The main script activates it via:</div>
</div><!-- fragment --><p> bash source /path/to/venv/bin/activate </p><div class="fragment"><div class="line">* The [c2c-sepia repository](https://github.com/josura/c2c-sepia) for MSE computation scripts.</div>
<div class="line">* The **MASFENON** repository for simulation scripts.</div>
<div class="line"> </div>
<div class="line">### B.3.6 Outputs</div>
<div class="line"> </div>
<div class="line">For each epoch, the output folder contains:</div>
<div class="line"> </div>
<div class="line">* Simulation outputs from the current parameters.</div>
<div class="line">* MSE tables for all fitted timepoints.</div>
<div class="line">* Updated parameter range files for the next epoch.</div>
<div class="line"> </div>
<div class="line">### B.3.7 Example Run</div>
<div class="line"> </div>
<div class="line">Example: 3-epoch manual range fitting starting from 0.1â€“1.0 with 5 intervals:</div>
</div><!-- fragment --><p> bash ./fit-and-run-simulation.sh 3 out_fitting 0.1 1.0 5 </p><div class="fragment"><div class="line">The final MSE results and the best parameters are stored in `out_fitting`.</div>
<div class="line"> </div>
<div class="line">### B.3.8 Per-Node Error-Based Adjustment Script</div>
<div class="line"> </div>
<div class="line">In addition to the global fitting workflow, a second (non-public) script exists for fine-grained parameter tuning.</div>
<div class="line">Instead of computing MSE on aggregated outputs, this script:</div>
<div class="line"> </div>
<div class="line">1. Selects a specific network or subnetwork.</div>
<div class="line">2. Computes error **per individual node** with respect to experimental data.</div>
<div class="line">3. Aggregates per-node errors to identify parameter sensitivities.</div>
<div class="line">4. Adjusts dissipation, propagation, and conservation parameters independently.</div>
<div class="line"> </div>
<div class="line">This method is useful for:</div>
<div class="line"> </div>
<div class="line">* Networks with heterogeneous dynamics.</div>
<div class="line">* Subsets of nodes representing critical biological processes.</div>
<div class="line">* Iterative localized parameter tuning.</div>
<div class="line"> </div>
<div class="line">---</div>
<div class="line"> </div>
<div class="line">## B.4 Visualization</div>
<div class="line"> </div>
<div class="line">In addition to numerical outputs, **MASFENON** includes interactive visualization tools for exploring simulation results.</div>
<div class="line"> </div>
<div class="line">Two visualization scripts are available:</div>
<div class="line"> </div>
<div class="line">1. A single-network plotter for node time series (in `c2c-sepia/scripts/python/temporalSingleCell/plotResults_withLR.py`).</div>
<div class="line">2. A web-based multi-network explorer using Flask and Plotly (in `MASFENON/scripts/python/visualization/visualizationWebPageComplete.py`).</div>
<div class="line"> </div>
<div class="line">### B.4.1 Web Application for Multi-Network Visualization</div>
<div class="line"> </div>
<div class="line">This tool provides an interactive web interface for visualizing all simulated networks and their temporal evolution.</div>
<div class="line">Implemented in **Flask** and **Plotly**, it allows:</div>
<div class="line"> </div>
<div class="line">* Selecting a network (*type*) from outputs.</div>
<div class="line">* Selecting a timepoint to visualize.</div>
<div class="line">* Inspecting node attributes and edge weights interactively.</div>
<div class="line">* Color mapping and node size scaling based on values.</div>
<div class="line"> </div>
<div class="line">#### B.4.1.1 Data Sources</div>
<div class="line"> </div>
<div class="line">The app uses:</div>
<div class="line"> </div>
<div class="line">1. **Iteration matrices**: `&lt;OutputDirectory&gt;/&lt;type&gt;.tsv`</div>
<div class="line">2. **Augmented graph files**: `&lt;AugmentedGraphDirectory&gt;/&lt;type&gt;.tsv`</div>
<div class="line">3. **Initial node values**: `&lt;InputValuesDirectory&gt;/&lt;type&gt;.tsv`</div>
<div class="line"> </div>
<div class="line">#### B.4.1.2 Preprocessing and Caching</div>
<div class="line"> </div>
<div class="line">At startup, the app:</div>
<div class="line"> </div>
<div class="line">* Reads all `.tsv` output files.</div>
<div class="line">* Loads node value series and graph structure.</div>
<div class="line">* Generates a static **networkx spring layout**.</div>
<div class="line">* Creates Plotly traces for edges and nodes for every timepoint.</div>
<div class="line">* Saves pickled caches:</div>
<div class="line"> </div>
<div class="line">  * `node_traces_for_networks.pkl`</div>
<div class="line">  * `edge_traces_for_networks.pkl`</div>
<div class="line">  * `dict_for_plot.pkl`</div>
<div class="line"> </div>
<div class="line">#### B.4.1.3 Server Routes</div>
<div class="line"> </div>
<div class="line">* `/` â†’ main interface with slider</div>
<div class="line">* `/read_types` â†’ list of network types</div>
<div class="line">* `/types/&lt;type&gt;` â†’ set active network</div>
<div class="line">* `/plot/&lt;timepoint&gt;` â†’ figure JSON for current type at timepoint</div>
<div class="line">* `/plot_singular/&lt;type&gt;/&lt;timepoint&gt;` â†’ figure JSON for specific type/timepoint</div>
<div class="line"> </div>
<div class="line">#### B.4.1.4 Visualization Details</div>
<div class="line"> </div>
<div class="line">* **Edges**: thin gray lines (`#888`), hover = weight</div>
<div class="line">* **Nodes**: `YlGnBu` reversed scale, size âˆˆ \[4,22]</div>
<div class="line">* **Layout**: fixed `spring_layout`</div>
<div class="line">* **Annotations**: fixed parameter settings shown</div>
<div class="line"> </div>
<div class="line">#### B.4.1.5 Workflow Summary</div>
</div><!-- fragment --><p> bash python3 visualizationWebPageComplete.py ```</p>
<p>Then open <a href="http://127.0.0.1:5000">http://127.0.0.1:5000</a> in a browser.</p>
<hr  />
<h2><a class="anchor" id="autotoc_md9"></a>
B.5 Legacy Framework: c2c-SEPIA</h2>
<p>Before the standalone release of <b>MASFENON</b>, its initial development and related experiments, scripts, and input preparation pipelines were maintained in the <a href="https://github.com/josura/c2c-sepia">c2c-sepia repository</a>.</p>
<p>This legacy repository still contains:</p>
<ul>
<li>Original MASFENON source code (pre-migration).</li>
<li>Scripts for single-cell experiments.</li>
<li>Utilities for image documentation.</li>
<li>Example datasets and workflows for cell-to-cell communication (CCC) simulations.</li>
</ul>
<p>It was designed for <b>cell-to-cell communication simulations with enriched pathways</b>, using annotated scRNA-seq data and multi-agent system (MAS) principles, extended with parallel and distributed computation.</p>
<p>Dependencies and build process are nearly identical to MASFENON. The legacy repo now mainly contains domain-specific scripts for CCC simulation.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Additional Scripts and Utilities</h3>
<p>The <b>MASFENON</b> repository also provides scripts for:</p>
<ul>
<li>Input dataset generation (biological, epidemiological, etc.).</li>
<li>Preprocessing pipelines for single-cell data (including missing-data handling).</li>
<li>Scenario-specific transformations and format conversions.</li>
</ul>
<p>These are <b>not detailed here</b> since:</p>
<ul>
<li>Input preparation was already described in the main text.</li>
<li>Scripts are documented in other research articles and repository <code>README</code> files.</li>
</ul>
<p>For comprehensive instructions, refer to those sources. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
